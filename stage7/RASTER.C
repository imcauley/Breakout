/*=========================================

Source File:
raster.c

Author(s):
Daniel Jackins
Isaac McAuley

Date Last Changed:
March 23 2018

Class: COMP 2659 - 001
Instructor: Paul Pospisil

==========================================*/

#include "raster.h"

const UINT8 font[] =
{
0x00,0x78,0x8C,0x94,0xA4,0xC4,0x78,0x00,  /* 0 */
0x00,0x60,0xA0,0x20,0x20,0x20,0xF8,0x00,  /* 1 */
0x00,0x78,0x84,0x04,0x78,0x80,0xFC,0x00,  /* 2 */
0x00,0x78,0x84,0x18,0x04,0x84,0x78,0x00,  /* 3 */
0x00,0x10,0x30,0x50,0x90,0xFC,0x10,0x00,  /* 4 */
0x00,0xFC,0x80,0xF8,0x04,0x84,0x78,0x00,  /* 5 */
0x00,0x78,0x80,0xF8,0x84,0x84,0x78,0x00,  /* 6 */
0x00,0xFC,0x04,0x08,0x10,0x20,0x20,0x00,  /* 7 */
0x00,0x78,0x84,0x78,0x84,0x84,0x78,0x00,  /* 8 */
0x00,0x78,0x84,0x84,0x7C,0x04,0x78,0x00,  /* 9 */
0x00,0x00,0x00,0x10,0x00,0x00,0x10,0x00,  /* : */
0x00,0x00,0x10,0x00,0x00,0x10,0x10,0x20,  /* ; */
0x00,0x00,0x08,0x10,0x20,0x10,0x08,0x00,  /* < */
0x00,0x00,0x00,0x7C,0x00,0x7C,0x00,0x00,  /* = */
0x00,0x00,0x20,0x10,0x08,0x10,0x20,0x00,  /* > */
0x00,0x3C,0x42,0x04,0x08,0x00,0x08,0x00,  /* ? */

0x00,0x3C,0x4A,0x56,0x5E,0x40,0x3C,0x00,  /* @ */
0x00,0x78,0x84,0x84,0xFC,0x84,0x84,0x00,  /* A */
0x00,0xF8,0x84,0xF8,0x84,0x84,0xF8,0x00,  /* B */
0x00,0x78,0x84,0x80,0x80,0x84,0x78,0x00,  /* C */
0x00,0xF0,0x88,0x84,0x84,0x88,0xF0,0x00,  /* D */
0x00,0xFC,0x80,0xF8,0x80,0x80,0xFC,0x00,  /* E */
0x00,0xFC,0x80,0xF8,0x80,0x80,0x80,0x00,  /* F */
0x00,0x78,0x84,0x80,0x9C,0x84,0x78,0x00,  /* G */
0x00,0x84,0x84,0xFC,0x84,0x84,0x84,0x00,  /* H */
0x00,0x7C,0x10,0x10,0x10,0x10,0x7C,0x00,  /* I */
0x00,0x04,0x04,0x04,0x84,0x84,0x78,0x00,  /* J */
0x00,0x88,0x90,0xE0,0x90,0x88,0x84,0x00,  /* K */
0x00,0x80,0x80,0x80,0x80,0x80,0xFC,0x00,  /* L */
0x00,0x84,0xCC,0xB4,0x84,0x84,0x84,0x00,  /* M */
0x00,0x84,0xC4,0xA4,0x94,0x8C,0x84,0x00,  /* N */
0x00,0x78,0x84,0x84,0x84,0x84,0x78,0x00,  /* O */

0x00,0xF8,0x84,0x84,0xF8,0x80,0x80,0x00,  /* P */
0x00,0x78,0x84,0x84,0xA4,0x94,0x78,0x00,  /* Q */
0x00,0xF8,0x84,0x84,0xF8,0x88,0x84,0x00,  /* R */
0x00,0x78,0x80,0x78,0x04,0x84,0x78,0x00,  /* S */
0x00,0xFE,0x10,0x10,0x10,0x10,0x10,0x00,  /* T */
0x00,0x84,0x84,0x84,0x84,0x84,0x78,0x00,  /* U */
0x00,0x84,0x84,0x84,0x84,0x48,0x30,0x00,  /* V */
0x00,0x84,0x84,0x84,0x84,0xB4,0x48,0x00,  /* W */
0x00,0x84,0x48,0x30,0x30,0x48,0x84,0x00,  /* X */
0x00,0x82,0x44,0x28,0x10,0x10,0x10,0x00,  /* Y */
0x00,0xFC,0x08,0x10,0x20,0x40,0xFC,0x00,  /* Z */
0x00,0x38,0x20,0x20,0x20,0x20,0x38,0x00,  /* [ */
0x00,0x00,0x40,0x20,0x10,0x08,0x04,0x00,  /* <backslash> */
0x00,0x38,0x08,0x08,0x08,0x08,0x38,0x00,  /* ] */
0x00,0x10,0x28,0x44,0x00,0x00,0x00,0x00,  /* ^ */
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0xFE,  /* _ */

0x3C,0x42,0x99,0xA1,0xA1,0x99,0x42,0x3C,  /* ` */
0x00,0x00,0x38,0x04,0x3C,0x44,0x3C,0x00,  /* a */
0x00,0x40,0x40,0x78,0x44,0x44,0x78,0x00,  /* b */
0x00,0x00,0x1C,0x20,0x20,0x20,0x1C,0x00,  /* c */
0x00,0x04,0x04,0x3C,0x44,0x44,0x3C,0x00,  /* d */
0x00,0x00,0x38,0x44,0x78,0x40,0x3C,0x00,  /* e */
0x00,0x0C,0x10,0x18,0x10,0x10,0x10,0x00,  /* f */
0x00,0x00,0x3E,0x42,0x42,0x3E,0x02,0x3C,  /* g */
0x00,0x40,0x40,0x78,0x44,0x44,0x44,0x00,  /* h */
0x00,0x08,0x00,0x18,0x08,0x08,0x1C,0x00,  /* i */
0x00,0x04,0x00,0x04,0x04,0x04,0x24,0x18,  /* j */
0x00,0x40,0x50,0x60,0x60,0x50,0x48,0x00,  /* k */
0x00,0x10,0x10,0x10,0x10,0x10,0x0C,0x00,  /* l */
0x00,0x00,0x68,0x54,0x54,0x54,0x54,0x00,  /* m */
0x00,0x00,0x78,0x44,0x44,0x44,0x44,0x00,  /* n */
0x00,0x00,0x38,0x44,0x44,0x44,0x38,0x00,  /* o */

0x00,0x00,0x78,0x44,0x44,0x78,0x40,0x40,  /* p */
0x00,0x00,0x3C,0x44,0x44,0x3C,0x04,0x06,  /* q */
0x00,0x00,0x1C,0x20,0x20,0x20,0x20,0x00,  /* r */
0x00,0x00,0x38,0x40,0x38,0x04,0x78,0x00,  /* s */
0x00,0x10,0x38,0x10,0x10,0x10,0x0C,0x00,  /* t */
0x00,0x00,0x44,0x44,0x44,0x44,0x38,0x00,  /* u */
0x00,0x00,0x44,0x44,0x28,0x28,0x10,0x00,  /* v */
0x00,0x00,0x44,0x54,0x54,0x54,0x28,0x00,  /* w */
0x00,0x00,0x44,0x28,0x10,0x28,0x44,0x00,  /* x */
0x00,0x00,0x44,0x44,0x44,0x3C,0x04,0x38,  /* y */
0x00,0x00,0x7C,0x08,0x10,0x20,0x7C,0x00,  /* z */
0x00,0x1C,0x10,0x60,0x10,0x10,0x1C,0x00,  /* { */
0x00,0x10,0x10,0x10,0x10,0x10,0x10,0x00,  /* | */
0x00,0x70,0x10,0x0C,0x10,0x10,0x70,0x00,  /* } */
0x00,0x14,0x28,0x00,0x00,0x00,0x00,0x00  /* ~ */
};

/* HEADER BLOCK */


/*=== plot_bitmap_8 ===========================================================

Purpose: Plots bitmaps with widths of 8 bits to the given screen position.

Inputs: 
    *base - beginning of screen buffer
        x - x coordinate for beginning of image
        y - y coordinate for beginning of image
  *bitmap - image to be drawn
   height - height of image
            

Outputs: Draws the image to the screen.

Limitations/Known bugs: N/A
=============================================================================*/

void plot_bitmap_8(UINT8 *base, int x, int y, const UINT8 *bitmap, unsigned int height)
{
    int i;
    
    for (i = 0; i < height; i++)
    {
        *(base + y * 80 + (x >> 3)) |= bitmap[i];
        base += 80;
    }
}

/*=== plot_bitmap_16 ===========================================================

Purpose: Plots bitmaps with widths of 16 bits to the given screen position.

Inputs: 
    *base - beginning of screen buffer
        x - x coordinate for beginning of image
        y - y coordinate for beginning of image
  *bitmap - image to be drawn
   height - height of image
            

Outputs: Draws the image to the screen.

Limitations/Known bugs: N/A
=============================================================================*/

void plot_bitmap_16(UINT16 *base, int x, int y, const UINT16 *bitmap, 
			unsigned int height)
{
    int i;
    UINT16 offset = x % 16;

    UINT16 extra_mask = 0xFFFF >> (16 - offset);
    UINT16 extra = 0xFFFF;
   
    for (i = 0; i < height; i++)
    {
        extra = bitmap[i];
	extra &= extra_mask;
	extra = extra << (16 - offset);

        *(base + y * 40 + (x >> 4)) |= (bitmap[i] >> offset);
	*((base + y * 40 + ((x + 16) >> 4))) |= extra;
        y++;
    }

}

/*=== plot_bitmap_32 ===========================================================

Purpose: Plots bitmaps with widths of 32 bits to the given screen position.

Inputs: 
    *base - beginning of screen buffer
        x - x coordinate for beginning of image
        y - y coordinate for beginning of image
  *bitmap - image to be drawn
   height - height of image
            

Outputs: Draws the image to the screen.

Limitations/Known bugs: N/A
=============================================================================*/


void plot_bitmap_32(UINT32 *base, int x, int y, const UINT32 *bitmap, unsigned int height)
{
    int i;
    
    for (i = 0; i < height; i++)
    {
        *(base + y * 20 + (x >> 5)) = bitmap[i];
        base += 20;
    }
}

/*=== clear_screen ============================================================

Purpose: Clears the screen (to black)

Inputs:
    *base - beginning of screen buffer

Outputs:
    Draws a black screen

Limitations/Known bugs: N/A
=============================================================================*/

void clear_screen(UINT32 *base)
{
	int x = 0;
	while(x++ < 8000)
	{
		*(base++) = 0xFFFFFFFF;
	}
}

void draw_hori_line(UINT16 *base, int x, int y, int length)
{
    UINT16 start = 0xFFFF;
    UINT16 end = 0xFFFF;

    int start_word = x / 16;
    int end_word = ((x + length) / 16) + 1;

    base += (y * 40);

    if((x && 16) != 0)
    {
	start = start >> (x % 16);
	start = ~start;
    }    
 
    if(((x + length) && 16) != 0)
    {
	end = end << (16 - ((x + length) % 16));
        end = ~end;
    }

    *(base + start_word) &= start;
    start_word++;

    while(start_word < end_word)
    {     
	*(base + start_word) &= 0x0000;
        start_word++;
    }
    
    *(base + start_word) &= end;
        
}

void draw_vert_line(UINT16 *base, int x, int y, int length)
{
    int i;
    
    for (i = 0; i < length; i++)
    {
        *(base + y * 40 + (x >> 4)) |= 1 << (15 - (x & 15));
        base += 40;
    }

}

void plot_pixel(UINT16 *base, int x, int y)
{
    *(base + (y * 40) + (x >> 4)) &= ~(0x8000 >> (x && 16));
}

void draw_rect(UINT16 *base, int x, int y, int length, int height)
{
    int i;
    
    for (i = 0; i < height; i++)
    {    
        draw_hori_line(base, x, y, length);
        y++;
    }
}

void draw_64rect(UINT32 *base, int x, int y, int height, bool clear)
{
    int r;
    int offset = (x & 31);
    int c = (x >> 5);
    
    UINT32 start = 0xFFFFFFFF >> offset;
    UINT32 mid = 0xFFFFFFFF;
    UINT32 end = 0xFFFFFFFF << (32 - offset);
    
    if(!clear)
    {
        start = ~start;
        mid = ~mid;
        end = ~end;
        
        r = 0;
        while(r < height)
        {
            *(base + (y * 20) + c) = start;
            *(base + (y * 20) + (c + 1)) = mid;
            *(base + (y * 20) + (c + 2)) = end;
            y++;
            r++;
        }
    }
    else
    {
        r = 0;
        while(r < height)
        {
            *(base + (y * 20) + c) |= start;
            *(base + (y * 20) + (c + 1)) |= mid;
            *(base + (y * 20) + (c + 2)) |= end;
            y++;
            r++;
        }
    }
}

void draw_8rect(UINT8 *base, int x, int y, int height, bool clear)
{
    int r;
    int offset = (x & 7);
    int c = (x >> 3);
    
    UINT8 start = 0xFF >> offset;
    UINT8 end = 0xFF << (8 - offset);
    
    if(!clear)
    {
        start = ~start;
        end = ~end;
        
        r = 0;
        while(r < height)
        {
            *(base + (y * 80) + c) = start;
            *(base + (y * 80) + (c+ 1)) = end;
            y++;
            r++;
        }
        
    }
    else
    {
        r = 0;
        while(r < height)
        {
            *(base + (y * 80) + c) |= start;
            *(base + (y * 80) + (c+ 1)) |= end;
            y++;
            r++;
        }
        
    }
}


void plot_char(UINT8 *base, int x, int y, int character)
{
	int r;
	int letter;
	character *= 8;
	for(r = 0; r < 8; r++)
	{
		letter = character + r;
		*(base + (80*y) + x) = ~(font[letter]);
		y++;
	}
}

